
@if (TempData["Message"] != null)
{
    <script>
        alert('@TempData["Message"]')
    </script>
}

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <div class="listjs-table" id="customerList">
                    <div class="row g-4 mb-3">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center flex-wrap">
                                <h3 class="mb-0">
                                    <img src="~/images/Clogo.png" alt="Logo" style="height: 40px; width: auto; vertical-align: middle; margin-right: 8px;" />
                                    Customer Record Master
                                </h3>

                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerMasterModal" id="Btn_AddCustomer" onclick="ClearAllValue()">
                                        <i class="align-bottom me-1"></i> Add Customer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <table class="table align-middle table-nowrap" id="CustomerMasterTable_Id">
                        <thead class="table-primary">
                            <tr>
                                <th class="sort fw-bold">Sr. No.</th>
                                <th class="sort fw-bold">Customer Name</th>
                                <th class="sort fw-bold">Mobile No</th>
                                <th class="sort fw-bold">Gender</th>
                                <th class="sort fw-bold">Email ID</th>
                                <th class="sort fw-bold">Address</th>
                                <th class="sort fw-bold">Pincode</th>
                                <th class="sort fw-bold">Action</th>
                            </tr>
                        </thead>
                        <tbody id="CustOrder_tbody_coin_id" name="CustOrder_tbody_coin_nm">
                            @{
                                int count = 1;
                            }


                            @if (ViewBag.GetCustomerData.Tables.Count > 0 && ViewBag.GetCustomerData.Tables[0].Rows.Count > 0)
                            {

                                foreach (System.Data.DataRow dr in ViewBag.GetCustomerData.Tables[0].Rows)
                                {
                                    <tr>

                                        <td>@count</td>
                                        <td>@dr["customer_name"]</td>
                                        <td>@dr["mobile_no"]</td>
                                        <td>@dr["gender"]</td>
                                        <td>@dr["email_id"]</td>
                                        <td>@dr["address"]</td>
                                        <td>@dr["pincode"]</td>
                                        <td>
                                            <div class="d-flex gap-2">
                                                <div>
                                                    <span class="btn btn-sm btn-success" style="margin:1px; cursor:pointer;" onclick="EditCustomerId(@dr["id"])" id="Btn_EditCustomerId" data-bs-toggle="modal" data-bs-target="#EditCustomerMasterModal">
                                                        <i class="fa fa-edit"></i>
                                                    </span>
                                                </div>
                                                <div>
                                                    <button class="btn btn-sm btn-danger" onclick="confirmDelete(@dr["id"])" style="margin:1px; cursor:pointer;">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    count++;
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="100%" style="text-align:center; font-weight:bold;"> Data Not Found...</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
   
</div>


<div class="modal fade" id="addCustomerMasterModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductModalLabel">Add Customer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="ClearAllValue()"></button>
            </div>
            <div class="modal-body">
               
                @using (Html.BeginForm("SaveAddCustomer", "CRUD"))
                {
                    <div class="row px-3">
                        <label class="form-label">Customer Name<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control alphabetsOnly" name="CustomerName" id="Txt_CustomerNameId" required minlength="3" maxlength="100" />
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Mobile Number<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control numberOnly" name="Mobileno" id="Txt_MobileNumberId" required minlength="10" maxlength="13" />
                        <span id="WarnMobileId" style="display:none"></span>
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Gender<span style="color:red;font-weight:800">*</span></label>
                        <div class="row pt-2">
                            <div class="col-md-3">
                                <input type="radio" class="form-check-input" id="RadioIsMale" name="Gender" value="Male" checked required />
                                <label> Male </label>&nbsp;
                            </div>
                            <div class="col-md-4">
                                <input type="radio" class="form-check-input" id="RadioIsFemale" name="Gender" value="Female" required>&nbsp;
                                <label> Female</label>
                            </div>
                            <div class="col-md-4">
                                <input type="radio" class="form-check-input" id="RadioIsOther" name="Gender" value="Other" required>&nbsp;
                                <label> Other </label>
                            </div>
                        </div>
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Email ID<span style="color:red;font-weight:800">*</span></label>
                        <input type="email" class="form-control " name="EmailID" id="Txt_EmailId" required maxlength="50" />
                        <span id="WarnEmailId" style="display:none"></span>
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Address<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control " name="Address" id="Txt_AddressId" required maxlength="100" />
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">PinCode<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control numberOnly" name="Pincode" id="Txt_PincodeId" required maxlength="6" />
                    </div>
                    <br />
                    <div class="d-flex justify-content-end gap-2 px-3">
                        <div>
                            <button type="submit" class="btn btn-primary Btn_preventMultiEnter" id="Btn_SubmitId" onclick="return ValidateData()">
                                <i class="align-bottom me-1"></i> ADD
                            </button>
                        </div>
                        <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>


<div class="modal fade preventMultipleEnter" id="EditCustomerMasterModal" tabindex="-1" aria-labelledby="editCustomerModalLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCustomerModalLabel">Edit Customer Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick=ClearAllValue()></button>
            </div>
            <div class="modal-body">
            
                @using (Html.BeginForm("SaveEditCustomer", "CRUD"))
                {
                    <input type="hidden" id="RecordId" name="UpdateRecordId" />
                    <div class="row px-3">
                        <label class="form-label">Customer Name<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control alphabetsOnly" name="CustomerName" id="UpdateTxt_CustomerNameId" required minlength="3" maxlength="100" />
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Mobile Number<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control numberOnly" name="Mobileno" id="UpdateTxt_MobileNumberId" required minlength="10" maxlength="13" />
                        <span id="UpdateWarnMobileId" style="display:none"></span>
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Gender<span style="color:red;font-weight:800">*</span></label>
                        <div class="row pt-2">
                            <div class="col-md-3">
                                <input type="radio" class="form-check-input" id="UpdateRadioIsMale" name="Gender" value="Male" checked required />
                                <label> Male </label>&nbsp;
                            </div>
                            <div class="col-md-4">
                                <input type="radio" class="form-check-input" id="UpdateRadioIsFemale" name="Gender" value="Female" required>&nbsp;
                                <label> Female</label>
                            </div>
                            <div class="col-md-4">
                                <input type="radio" class="form-check-input" id="UpdateRadioIsOther" name="Gender" value="Other" required>&nbsp;
                                <label> Other </label>
                            </div>
                        </div>
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Email ID<span style="color:red;font-weight:800">*</span></label>
                        <input type="email" class="form-control " name="EmailID" id="UpdateTxt_EmailId" required maxlength="50" />
                        <span id="UpdateWarnEmailId" style="display:none"></span>
                    </div>
                    <div class="row px-3 mt-3">
                        <label class="form-label">Address<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control " name="Address" id="UpdateTxt_AddressId" required maxlength="100" />
                    </div>

                    <div class="row px-3 mt-3">
                        <label class="form-label">PinCode<span style="color:red;font-weight:800">*</span></label>
                        <input type="text" class="form-control numberOnly" name="Pincode" id="UpdateTxt_PincodeId" required maxlength="6" />
                    </div>

                    <br />
                    <div class="d-flex justify-content-end gap-2 px-3">
                        <div>
                            <button type="submit" class="btn btn-primary d-grid" id="Btn_UpdateId">
                                <i class="align-bottom me-1"></i> Update
                            </button>
                        </div>

                        <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

    function confirmDelete(id) {
        if (confirm("Are you sure you want to delete this record?")) {
        
            window.location.href = '/CRUD/DeleteCustomerRecord/' + id;
        }
    }

   
    function EditCustomerId(id) {
        $.ajax({
            type: "POST",
            url: "/CRUD/EditCustomer",
            data: {
                ID: id,
            },
            success: function (data) {
                var res = JSON.parse(data);
                var CustomerData = res["CustomerData"]
               
                document.getElementById('RecordId').value = CustomerData[0]["id"];
                document.getElementById('UpdateTxt_CustomerNameId').value = CustomerData[0]["customer_name"];
                document.getElementById('UpdateTxt_MobileNumberId').value = CustomerData[0]["mobile_no"];
                document.getElementById('UpdateTxt_EmailId').value = CustomerData[0]["email_id"];
                document.getElementById('UpdateTxt_AddressId').value = CustomerData[0]["address"];
                document.getElementById('UpdateTxt_PincodeId').value = CustomerData[0]["pincode"];

               
                if (CustomerData[0]["gender"] == "Male") {
                    $("#UpdateRadioIsMale").prop("checked", true);
                }
                else if (CustomerData[0]["gender"] == "Female") {
                    $("#UpdateRadioIsFemale").prop("checked", true);
                }
                else {
                    $("#UpdateRadioIsOther").prop("checked", true);
                }
            },
            error: function (response) {
                console.log("error")

            }
        });
    }


  
    function ClearAllValue() {
        $("#Txt_CustomerNameId").val("");
        $("#Txt_MobileNumberId").val("");
        $("#Txt_EmailId").val("");
        $("#Txt_AddressId").val("");
        $("#Txt_PincodeId").val("");
        $("#UpdateWarnMobileId").css({ "display": "none" });
        $("#WarnMobileId").css({ "display": "none" });
    }




    $(document).on('keypress', '.numberOnly', function (event) {
        var regex = new RegExp("^[0-9]+$");
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if (!regex.test(key)) {
            event.preventDefault();
            return false;
        }
    });

    $(document).on('keypress', '.alphabetsOnly', function (event) {
        var regex = new RegExp("^[a-zA-Z \s]+$");
        var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
        if (!regex.test(key)) {
            event.preventDefault();
            return false;
        }
    });


    
    $('#Txt_MobileNumberId, #UpdateTxt_MobileNumberId, #UpdateTxt_EmailId, #Txt_EmailId').on("change paste", function () {
        const inputField = $(this); 
        const inputFieldId = inputField.attr('id');
        const value = inputField.val();

        
        $("#WarnMobileId, #UpdateWarnMobileId, #WarnEmailId, #UpdateWarnEmailId").hide();

        let colName = "";
        let warningSelector = "";

        if (inputFieldId === "Txt_MobileNumberId") {
            colName = "mobile_no";
            warningSelector = "#WarnMobileId";
        } else if (inputFieldId === "UpdateTxt_MobileNumberId") {
            colName = "mobile_no";
            warningSelector = "#UpdateWarnMobileId";
        } else if (inputFieldId === "Txt_EmailId") {
            colName = "email_id";
            warningSelector = "#WarnEmailId";
        } else if (inputFieldId === "UpdateTxt_EmailId") {
            colName = "email_id";
            warningSelector = "#UpdateWarnEmailId";
        }

        if (colName !== "") {
            CheckDuplicateRecord(colName, value, function (isDuplicate) {
                if (isDuplicate) {
                    $(warningSelector).show().css("color", "red").text(
                        colName === "mobile_no" ? "Mobile Number Already Exists..." : "Email Id Already Exists..."
                    );
                    inputField.val(''); 
                    inputField.focus(); 
                } else {
                    $(warningSelector).hide();
                }
            });
        }
    });

   
    function CheckDuplicateRecord(ColName, Value, callback) {
        $.ajax({
            type: "POST",
            url: "/CRUD/CheckDuplicateRecord",
            data: {
                ColName: ColName,
                Value: Value
            },
            success: function (data) {
                callback(data === true || data === "true" || data == 1);
            },
            error: function (response) {
                console.error("Error during AJAX request:", response);
                callback(false);
            }
        });
    }
</script>

